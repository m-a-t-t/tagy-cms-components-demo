function ViewState(a,b){this.states=a,this._active=b}function EchoEventHandler(a,b){this.eventName=a,this.handlerFn=b}!function(a,b){"use strict";function c(){function a(a,c){return b.extend(new(b.extend(function(){},{prototype:a})),c)}function c(a,b){var c=b.caseInsensitiveMatch,d={originalPath:a,regexp:a},e=d.keys=[];return a=a.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(a,b,c,d){var f="?"===d?d:null,g="*"===d?d:null;return e.push({name:c,optional:!!f}),b=b||"",""+(f?"":b)+"(?:"+(f?b:"")+(g&&"(.+?)"||"([^/]+)")+(f||"")+")"+(f||"")}).replace(/([\/$\*])/g,"\\$1"),d.regexp=new RegExp("^"+a+"$",c?"i":""),d}var d={};this.when=function(a,e){if(d[a]=b.extend({reloadOnSearch:!0},e,a&&c(a,e)),a){var f="/"==a[a.length-1]?a.substr(0,a.length-1):a+"/";d[f]=b.extend({redirectTo:a},c(f,e))}return this},this.otherwise=function(a){return this.when(null,a),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(c,e,f,g,h,i,j,k){function l(a,b){var c=b.keys,d={};if(!b.regexp)return null;var e=b.regexp.exec(a);if(!e)return null;for(var f=1,g=e.length;g>f;++f){var h=c[f-1],i="string"==typeof e[f]?decodeURIComponent(e[f]):e[f];h&&i&&(d[h.name]=i)}return d}function m(){var a=n(),d=q.current;a&&d&&a.$$route===d.$$route&&b.equals(a.pathParams,d.pathParams)&&!a.reloadOnSearch&&!p?(d.params=a.params,b.copy(d.params,f),c.$broadcast("$routeUpdate",d)):(a||d)&&(p=!1,c.$broadcast("$routeChangeStart",a,d),q.current=a,a&&a.redirectTo&&(b.isString(a.redirectTo)?e.path(o(a.redirectTo,a.params)).search(a.params).replace():e.url(a.redirectTo(a.pathParams,e.path(),e.search())).replace()),g.when(a).then(function(){if(a){var c,d,e=b.extend({},a.resolve);return b.forEach(e,function(a,c){e[c]=b.isString(a)?h.get(a):h.invoke(a)}),b.isDefined(c=a.template)?b.isFunction(c)&&(c=c(a.params)):b.isDefined(d=a.templateUrl)&&(b.isFunction(d)&&(d=d(a.params)),d=k.getTrustedResourceUrl(d),b.isDefined(d)&&(a.loadedTemplateUrl=d,c=i.get(d,{cache:j}).then(function(a){return a.data}))),b.isDefined(c)&&(e.$template=c),g.all(e)}}).then(function(e){a==q.current&&(a&&(a.locals=e,b.copy(a.params,f)),c.$broadcast("$routeChangeSuccess",a,d))},function(b){a==q.current&&c.$broadcast("$routeChangeError",a,d,b)}))}function n(){var c,f;return b.forEach(d,function(d){!f&&(c=l(e.path(),d))&&(f=a(d,{params:b.extend({},e.search(),c),pathParams:c}),f.$$route=d)}),f||d[null]&&a(d[null],{params:{},pathParams:{}})}function o(a,c){var d=[];return b.forEach((a||"").split(":"),function(a,b){if(0===b)d.push(a);else{var e=a.match(/(\w+)(.*)/),f=e[1];d.push(c[f]),d.push(e[2]||""),delete c[f]}}),d.join("")}var p=!1,q={routes:d,reload:function(){p=!0,c.$evalAsync(m)}};return c.$on("$locationChangeSuccess",m),q}]}function d(){this.$get=function(){return{}}}function e(a,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(n.remove(),n=null),l&&(l.$destroy(),l=null),m&&(d.leave(m,function(){n=null}),n=m,m=null)}function k(){var g=a.current&&a.current.locals,h=g&&g.$template;if(b.isDefined(h)){var k=e.$new(),n=a.current,q=i(k,function(a){d.enter(a,null,m||f,function(){!b.isDefined(o)||o&&!e.$eval(o)||c()}),j()});m=q,l=n.scope=k,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}function f(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f.locals;e.html(g.$template);var h=a(e.contents());if(f.controller){g.$scope=d;var i=b(f.controller,g);f.controllerAs&&(d[f.controllerAs]=i),e.data("$ngControllerController",i),e.children().data("$ngControllerController",i)}h(d)}}}var g=b.module("ngRoute",["ng"]).provider("$route",c);g.provider("$routeParams",d),g.directive("ngView",e),g.directive("ngView",f),e.$inject=["$route","$anchorScroll","$animate"],f.$inject=["$compile","$controller","$route"]}(window,window.angular),angular.module("uuid",[]).service("uuid4",function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";this.generate=function(){return a.replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}}),function(a,b){"use strict";b.module("tagyComponents",["uuid"]).directive("tagyCmsEditable",["$compile","$q","$sce","EditableSer","EditableMessageChannel","editableContentFactory",function(a,c,d,e,f,g){return{restrict:"A",replace:!0,priority:0,scope:{editableObj:"=",tagyCmsEditable:"@",editableEscapeHtml:"@"},controller:["$scope","$element","$attrs","$transclude",function(a,b){this.remove=function(c){a.editable.destroy(),a.$destroy(),1!=c&&f.dispatchUpdatedEvent(null,{element:b}),b.remove()}}],link:function(c,h,i){function j(a){var b=a;return null==b||""==b||"none"==b?b="":(b=b.replace('"',""),b=b.replace("url(",""),b=b.replace(")","")),b}var k=i.editableTitle;if((null==k||k.length<1)&&(k=i.tagyCmsEditable),!(null!=k&&k.length>0))return void h.text('Editable item needs a title, for example: tagy-cms-editable="title"');c.editable=g.getInstance(h,c,k,i.editableDescription,null,null);var l=h.prop("tagName"),m=function(){return null!=c.data&&null!=c.data.value&&b.isFunction(c.data.value.valueOf)?c.data.value.valueOf():c.data.value},n=function(a){null!=a.link&&(c.data.editProp_link=a.link,h.attr("href",c.data.editProp_link)),null!=c.data.editProp_backgroundImage&&(c.data.editProp_backgroundImage=""==a.backgroundImage||null==a.backgroundImage?"":a.backgroundImage,""!=c.data.editProp_backgroundImage?$(h).css("background-image",'url("'+c.data.editProp_backgroundImage+'")'):$(h).css("background-image","none"))};c.data={},"IMG"==l?(c.data.value=h.attr("src"),h.click(function(a){a.preventDefault(),a.stopPropagation(),c.$apply(function(){c.editable.value=c.data.value,f.dispatchEditEvent(c.editable)})}),c.update=function(a){a!=h.attr("src")&&b.isString(a)&&(h.attr("src",a),c.data.value=a,f.dispatchUpdatedEvent(c.editable,{element:c.editable.element}))}):"TITLE"==l?(c.data.value=h.html(),c.update=function(a){a!=h.html()&&b.isString(a)&&(h.html(a),c.data.value=a,f.dispatchUpdatedEvent(c.editable,{element:c.editable.element}))}):"META"==l?(c.data.value=h.attr("content"),c.update=function(a){a!=h.attr("content")&&b.isString(a)&&(h.attr("content",a),c.data.value=a,f.dispatchUpdatedEvent(c.editable,{element:c.editable.element}))}):(null!=c.editableObj&&null!=i.editablePropertyName?(c.$watch("editableObj."+i.editablePropertyName,function(a){c.data.value=a}),c.$watch("data.value",function(a){c.editableObj[i.editablePropertyName]=a}),c.data.value=c.editableObj[i.editablePropertyName],h.text("")):null==i.editableProps&&(c.data.value=h.html()),null==i.editableProps?("true"==c.editableEscapeHtml?$(h).empty().append("<span "+e.EDITABLE_BINDING_WRAP_ATTR_NAME+' ng-bind="data.value"></span>'):(c.data.value=d.trustAsHtml(c.data.value.toString()),$(h).empty().append("<span "+e.EDITABLE_BINDING_WRAP_ATTR_NAME+' ng-bind-html="data.value"></span>')),a(h.contents())(c)):(c.editable.value=null,c.data.value=null,i.editableProps.indexOf("background-image")>-1&&(c.data.editProp_backgroundImage=j($(h).css("background-image")),c.editable.editProps.backgroundImage=c.data.editProp_backgroundImage)),"A"==l&&(c.data.editProp_link=$(h).attr("href"),c.editable.editProps.link=c.data.editProp_link),h.click(function(a){a.preventDefault(),a.stopPropagation(),c.$apply(function(){c.editable.value=m(),f.dispatchEditEvent(c.editable)})}),c.update=function(a){b.isString(a)&&a!=c.data.value&&null!=c.data.value?(c.data.value="true"==c.editableEscapeHtml?a:d.trustAsHtml(a.toString()),f.dispatchUpdatedEvent(c.editable,{element:c.editable.element})):b.isObject(a)&&(n(a),f.dispatchUpdatedEvent(c.editable,{element:c.editable.element}))}),c.editable.value=m(),c.editable.registerOnComponent()}}}])}(window,angular),angular.module("tagyComponents").directive("tagyCmsComponent",["EditableSer","editableComponentFactory","EditableMessageChannel",function(a,b,c){return{replace:!1,restrict:"A",priority:10,scope:!0,controller:["$scope","$element","$attrs","$transclude",function(a,b){this.remove=function(d){a.editableComponent.destroy(),a.$destroy(),1!=d&&c.dispatchUpdatedEvent(null,{element:b}),b.remove()}}],link:{pre:function(a,c,d){a.editableComppp=!0,a.editableComponent=null;var e=d.editableTitle?d.editableTitle:d.tagyCmsComponent;a.editableComponent=null!=e?b.getInstance(e,c,a):b.getInstance("untitled",c,a)},post:function(){}}}}]),angular.module("tagyComponents").directive("tagyCmsItemEditor",["EditableMessageChannel","$timeout",function(a){return{template:'<div ng-show="isMyEditableItem()"><h3>{{_editableItem.title}} <br/><small>{{_editableItem.description}}</small></h3><div  ng-if="_editableItem.type==\'image\'"><img ng-src="{{filePath}}"/><input ng-model="_editableItem.value"><button class="button success" ng-click="doneEditing()">OK</button></div><form ng-if="_editableItem.type==\'text\'"><textarea ng-if="_editableItem.value!=null && _editableItem.editProps.backgroundImage==null" ui-tinymce="tinyMceOptions" class="form-control" ng-model="_editableItem.value"></textarea><div  ng-if="_editableItem.editProps.backgroundImage!=null"><img ng-src="{{filePath}}"/><input ng-model="_editableItem.editProps.backgroundImage"></div><div ng-if="_editableItem.editProps.link!=null" class="row">link:<input ng-model="_editableItem.editProps.link"></div><button class="button secondary tiny" ng-click="doneEditing()">close</button></form></div>',restrict:"E",scope:{showForEditableItem:"=",getFileAbsPath:"="},link:function(b){var c,d=null,e=function(){return b.$watch("_editableItem.value",function(c,d){c!=d&&null!=b._editableItem&&("image"!=b._editableItem.type&&null!=b._editableItem.editProps&&null!=b._editableItem.editProps.backgroundImage?b._editableItem.editProps.backgroundImage=c:a.dispatchNewValueUpdate(c,b._editableItem.scope.$id),b.filePath=b.getFileAbsPath?b.getFileAbsPath(c):c)})},f=function(){return b.$watch("_editableItem.editProps",function(c,d){c!=d&&null!=b._editableItem&&null!=b._editableItem.editProps&&(null!=c.backgroundImage&&(b.filePath=b.getFileAbsPath?b.getFileAbsPath(c.backgroundImage):c.backgroundImage),a.dispatchNewValueUpdate(b._editableItem.editProps,b._editableItem.scope.$id))},!0)};b.filePath="",b.tinyMceOptions={theme:"modern",skin:"light",toolbar:"undo redo| bold italic underline fontsizeselect | alignleft aligncenter alignright alignjustify | bullist numlist | link | fullscreen code template",menubar:!1,plugins:"link fullscreen code",forced_root_block:!1,resize:"both",valid_elements:"+*[*]",convert_urls:!1},b._editableItem=null;var g=null;a.onEdit(b,function(h){try{c(),d()}catch(i){}if(b.isMyEditableItem(b.showForEditableItem,h)){if(b._editableItem=h,c=e(),d=f(),b._editableItem&&("image"==b._editableItem.type||null!=b._editableItem.editProps&&null!=b._editableItem.editProps.backgroundImage)){null!=b._editableItem.editProps.backgroundImage&&(b._editableItem.value=null);var j=null!=b._editableItem.value?b._editableItem.value:b._editableItem.editProps.backgroundImage;b.filePath=b.getFileAbsPath?b.getFileAbsPath(j):j,a.dispatchSelectImageWaiting(b._editableItem)}}else b._editableItem=null;g=h}),a.onIframePreviewHtmlMarkupReset(b,function(){h()}),b.doneEditing=function(){a.dispatchEditableItemEditConfirmed(b._editableItem)};var h=function(){b.editValue=null,b._editableItem=null};a.onEditableItemEditConfirmed(b,function(a){g=null,b._editableItem==a&&h()}),b.isMyEditableItem=function(a,c){null==a&&(a=b.showForEditableItem),null==c&&(c=g);var d=!1;return d=null==a?null!=c:null!=c?null!=c&&c.scope.$id==a.scope.$id:!1}}}}]),angular.module("tagyComponents").directive("tagyCmsComponentList",["EditableSer","EditableMessageChannel",function(a,b){return{template:'<div ng-show="componentsOnPage.length>0"><div ng-if="isCurrentLayoutFr(frameworkConsts.LAYOUT_FRAMEWORK_BOOTSTRAP)" class="panel-group" id="editable-comp-accordion"><div ng-repeat="editableComponent in componentsOnPage" class="panel panel-danger"><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#editable-comp-accordion" href="#collapse_{{$index}}">{{editableComponent.title}} <span class="badge">{{editableComponent.getEditableContentObjects().length}}</span></a></h4> </div> <div id="collapse_{{$index}}" class="panel-collapse collapse"> <div class="panel-body"><ul><li ng-repeat="editableObject in editableComponent.getEditableContentObjects()"><a href="" ng-click="editEditableObject(editableObject)"> {{editableObject.title}} </a> </li></ul></div> </div> </div></div><dl ng-show="isCurrentLayoutFr(frameworkConsts.LAYOUT_FRAMEWORK_FOUNDATION)" class="accordion" data-accordion id="editable-comp-accordion"><dd ng-repeat="editableComponent in componentsOnPage"><a href="" ng-click="setNowEditingComponent(editableComponent)">{{editableComponent.title}}</a><div class="content" ng-class="{active:nowEditingComponent==editableComponent}"><ul><li ng-repeat="editableObject in editableComponent.getEditableContentObjects()"><a href="" ng-hide="isNowEditing(editableObject)" ng-click="editEditableObject(editableObject)"> {{editableObject.title}}</a><tagy-cms-item-editor show-For-Editable-Item="editableObject" get-File-Abs-Path="getFileAbsPath"></tagy-cms-item-editor> </li></ul></div></dd></dl></div>',restrict:"E",scope:{getFileAbsPath:"="},link:function(c){c.nowEditing,c.frameworkConsts=a.frwConst,c.isCurrentLayoutFr=function(b){return a.layoutFramework==b},b.onEditableComponentAdded(c,function(a,b){c.componentsOnPage=b}),b.onEditableComponentRemoved(c,function(a){var b=e(a.id);if(b){var d=c.componentsOnPage.indexOf(b);c.componentsOnPage.splice(d,1)}}),b.onEditableComponentUpdated(c,function(a){var b=e(a.id);a!==b&&(b=a)}),c.editEditableObject=function(a){b.dispatchEditEvent(a)},c.setNowEditingComponent=function(a){if(c.nowEditingComponent!=a){c.nowEditingComponent=c.nowEditingComponent==a?null:a;var b=a.getEditableContentObjects();1==b.length&&c.editEditableObject(b[0])}},b.onEdit(c,function(a){c.nowEditing=a;var b=d(a);b&&c.setNowEditingComponent(b)});var d=function(a){for(var b=0;b<c.componentsOnPage.length;b++){var d=c.componentsOnPage[b];if(d.hasEditableItemObj(a))return d}return null},e=function(a){if(null!=c.componentsOnPage){for(var b=0;b<c.componentsOnPage.length;b++){var d=c.componentsOnPage[b];if(d.id==a)return d}return null}};c.isNowEditing=function(a){return null!=c.nowEditing?a.scope.$id==c.nowEditing.scope.$id:!1},b.onEditableItemEditConfirmed(c,function(a){c.nowEditing==a&&(c.nowEditing=null)}),c.isCurrentLayoutFr(a.frwConst.LAYOUT_FRAMEWORK_BOOTSTRAP)&&$("#editable-comp-accordion").collapse()}}}]),angular.module("tagyComponents").directive("iframePreviewEditorDr",["$q","$window","$timeout","markupChangeIdFac","EditableSer","$rootScope","EditableStyleSer","CrossFrameEditableService","EditHtmlService","CrossFrameConnection","EditableMessageChannel",function(a,b,c,d,e,f,g,h,i,j,k){return{template:'<div class="row">             <div id="iframe-preview-target-holder" class="small-12 columns"><iframe id="iframe-preview-target" name="iframePreviewTarget" src="about:blank" class="iframe-previewer" frameborder="0" width="100%" height="100%" scrolling="auto" style="min-height: 800px;"></iframe></div></div>',restrict:"E",scope:{},link:function(b){var e=null,f=null;k.onEditableHtmlMarkupChange(b,function(a,b,c){b>f&&(m(c),k.dispatchIframePreviewHtmlMarkupReset(a,b))});var g=function(){var a=d.changeMarkupChangeId(i.cleanEditFrameworkCode(h()));f=d.getCurrentChangeId(a),i.editHtmlMarkup(a)};j.onFrameConnectionSuccess(b,function(){j.addCrossFrameEventListener(new EchoEventHandler(k.EVENT_EDIT_UPDATED,g)),j.addCrossFrameEventListener(new EchoEventHandler(k.EVENT_EDITABLE_STYLE_VALUE_UPDATED,g))});var h=function(){if(null==e)return null;var a=i.getDocTypeAsString(e)+e.documentElement.outerHTML;return a},l=function(){var b=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,d=a.defer();return null==e?(e=document.querySelector("#iframe-preview-target").contentWindow.document,d.resolve(e)):b?d.resolve(e):($("#iframe-preview-target").remove(),$("#iframe-preview-target-holder").append('<iframe id="iframe-preview-target" name="iframePreviewTarget" src="about:blank" class="iframe-previewer" frameborder="0" width="100%" height="100%" scrolling="auto" style="min-height: 800px;"></iframe>'),c(function(){e=document.querySelector("#iframe-preview-target").contentWindow.document,d.resolve(e)},0)),d.promise},m=function(a){var b=l();b.then(function(b){null!=b&&(b.open("text/html","replace"),b.write(a),b.close(),j.connectFrames(b))})}}}}]),angular.module("tagyComponents").directive("htmlMarkupEditorDr",["markupChangeIdFac","EditableStyleSer","$rootScope","EditHtmlService","EditableMessageChannel","$timeout",function(a,b,c,d,e){return{template:'<div><textarea id="edit-html-iframe-markup-field" ng-model="editHtml" style="height: 300px;"></textarea><a ng-show="displayButton==true" class="button success" ng-click="updateHtmlPreview()">preview changes</a></div>',restrict:"E",scope:{editHtml:"@",displayButton:"@"},link:function(b){var c;e.onEditableHtmlMarkupChange(b,function(d,e){(e>c||null==a.getMarkupChangeId(b.editHtml))&&(b.editHtml=d)}),b.updateHtmlPreview=function(){var e=a.changeMarkupChangeId(b.editHtml);c=a.getCurrentChangeId(e),d.editHtmlMarkup(e)}}}}]),angular.module("tagyComponents").directive("tagyCmsSync",["EditableMessageChannel",function(a){return{replace:!1,restrict:"A",scope:!1,link:{post:function(b,c){var d="tagy-cms-sync-now";"STYLE"==c.prop("tagName")?a.onStyleValueChange(b,function(){c.attr(d,"true")}):a.onUpdated(b,function(a,b){var e=null!=a&&null!=a.element?a.element:b.element;if(e&&null!=e.get){var f=e.get(0);if(null!=f){var g=c.get(0),h=$.contains(g,f);h&&c.attr(d,"true")}}else console.log("INFO tagy-cms-sync: can not get updated element")})}}}}]),angular.module("tagyComponents").directive("tagyCmsGallery",["$compile","$rootScope","EditHtmlService","EditableMessageChannel","editableContentFactory","editableComponentFactory",function(a,b,c,d,e,f){return{restrict:"A",scope:{},replace:!1,link:function(g,h){g.isGallery=!0,g.editableComppp=!1;var i=null,j=h.html(),k=j.indexOf("tagy-cms-gallery-item");if(k>0){var l=j.lastIndexOf("<",k),m=j.indexOf("-->",k);l>-1&&m>-1&&(i=j.substring(l,m))}g.removeElementWithEditableContent=function(a){a=$(a);var b=[],c=f.getViewComponentAttributeName(),g=f.getViewComponentDirectiveName(),h=!1;a.is(c)?(b.push(a),h=!0):b=a.find(c);for(var i=0;i<b.length;i++){var j=$(b[i]);j.controller(g).remove(!0)}if(!h){var k=[],l=e.getViewComponentAttributeName(),m=e.getViewComponentDirectiveName();a.is(l)?k.push(a):k=a.find(l);for(var i=0;i<k.length;i++){var j=$(k[i]);j.controller(m).remove(!0)}}d.dispatchUpdatedEvent(null,{element:a}),a.remove()};var n=function(e){var f=$(e),h=f.children(".tagy-cms-gallery-controls");if(h.length<1){var h=$("<div remove-in-production class='tagy-cms-gallery-controls'><style>[tagy-cms-gallery] .selected-item_remove-in-production{border:dotted 1px lime}.tagy-cms-gallery-controls .button.tiny{margin:0px;font-size:18px;padding-top: .12em;padding-bottom: .12em;padding-right: .5em;padding-left: .5em;}</style><a tagy-cms-remove-gallery-item class='button tiny alert' href='' style='background-color: red;color: #ffffff;'>-</a><a style='background-color: green; color: #ffffff;' tagy-cms-add-gallery-item class='button tiny' href=''>+</a></div> ");f.prepend(h)}$("[tagy-cms-add-gallery-item]",h).on("click",function(e){var h;if(null!=i)h=$(i);else{var j=f.clone().wrap("<div>").parent().html();j=c.cleanRemoveInProductionCssClasses(j),h=$(c.cleanEditableMarkupWraps(j))}n(h),f.after(h),a(h)(g.$new(!0)),d.dispatchUpdatedEvent(null,{element:f}),b.$apply(),e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),e&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}),$("[tagy-cms-remove-gallery-item]",h).on("click",function(a){confirm("You want to delete this?")&&(g.removeElementWithEditableContent(f),b.$apply(),a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation(),a&&a.stopImmediatePropagation&&a.stopImmediatePropagation())});var j=function(a){for(var b=$(a),c=b.closest("[tagy-cms-gallery]"),d=b.parents(),e=0;e<d.length;e++){var f=$(d[e]);if(f.is(c))return $(d[e-1])}};$("[tagy-cms-remove-gallery-item]",h).parent().hover(function(a){var b=j($(a.target));b&&b.addClass("selected-item_remove-in-production")},function(a){var b=j($(a.target));b&&b.removeClass("selected-item_remove-in-production")})};h.children().each(function(a,b){n(b)})}}}]),angular.module("tagyComponents").directive("tagyCmsEditableStyle",["EditableStyleSer","EditableMessageChannel","editableStyleItemFactory",function(a,b,c){return{replace:!1,restrict:"A",link:function(a,d){var e={};a.update=function(a){d.html(e.getUpdatedStyleStringWithNewValues(d.html(),a)),b.dispatchStyleValueUpdatedEvent(a)},e.getEditableStyleItemsFromCSSString=function(b){for(var f,g,h,i,j=[],k=b.indexOf("{",0);k>0&&(i=b.indexOf("}",k),!(0>i));)f=b.substring(k+1,i),h=b.lastIndexOf("}",k)+1,0>h&&(h=0),g=b.substring(h,k),g=g.replace(";",""),j.push(c.create({element:d,scope:a,className:g,bodyCss:f,title:e.parseTitleFromClassName(g),type:e.parseTypeFromClassName(g),value:e.parseValue(f),cssProperty:e.parseCSSProperty(f)})),k=b.indexOf("{",i);return j},e.parseTitleFromClassName=function(a){var b=a.indexOf("_"),c=a.indexOf("_",b+1),d=a.substring(b+1,c);return d=d.replace("-"," ")},e.parseTypeFromClassName=function(a){var b=a.lastIndexOf("_");return a.substr(b+1)},e.parseValue=function(a){var b=a.indexOf(":"),c=a.indexOf(";");return 0>c&&alert("no semicolon found at css editable declaration"),a.substring(b+1,c)},e.parseCSSProperty=function(a){var b=a.indexOf(":");return a.substring(0,b)},e.getUpdatedStyleStringWithNewValues=function(a,b){var c=a.length-1,d=a.indexOf(b.className);d>c&&alert("TOOO LATE");var e=a.indexOf("}",d),f=a.substring(d,e),g=f.indexOf(b.cssProperty);if(g>-1){var h=f.indexOf(":")+1,i=f.indexOf(";");return f=f.substring(0,h)+b.value+f.substr(i),a.substring(0,d)+f+a.substr(e)}return alert("Can't find css property to update with new value ("+b.className+b.bodyCss+")"),a},e.getEditableStyleItemsFromCSSString(d.html())}}}]),angular.module("tagyComponents").service("EditableSer",["EditableMessageChannel","$rootScope",function(a,b){var c=this,d={value:null,scopeId:null};this.frwConst={},this.frwConst.LAYOUT_FRAMEWORK_BOOTSTRAP="bootstrapFr",this.frwConst.LAYOUT_FRAMEWORK_FOUNDATION="foundationFr",this.layoutFramework=this.frwConst.LAYOUT_FRAMEWORK_FOUNDATION,this.EDITABLE_BINDING_WRAP_ATTR_NAME="editable-binding-w",this._editableComponents=[],this.registerComponent=function(b){c._editableComponents.push(b),a.dispatchEditableComponentAdded(b,c._editableComponents)},this.unregisterComponent=function(b){var d=c.getRegisteredComponent(b);if(d){var e=c._editableComponents.indexOf(d);e>-1&&(c._editableComponents.splice(e,1),a.dispatchEditableComponentRemoved(d,c._editableComponents))}},this.getRegisteredComponent=function(a){for(var b=0;b<c._editableComponents.length;b++){var d=c._editableComponents[b];if(d.id==a)return d}return null},this.unregisterComponents=function(){c._editableComponents=[],a.dispatchEditableComponentAdded(null,c._editableComponents)},this.getRegisteredComponents=function(){return c._editableComponents},a.onNewValueUpdateEditable(b,function(a,b){if(!angular.equals(d.value,a)||d.scopeId!=b)for(var e=0;e<c._editableComponents.length;e++){var f=c._editableComponents[e];if(f.setEditableItemNewValue(a,b))return d.scopeId=b,void(d.value=angular.copy(a))}});var e=null;a.onSelectImageWaiting(b,function(a){e=a}),a.onSelectedImagePath(b,function(a){null!=e&&(e.value=a)}),a.onEditableItemEditConfirmed(b,function(){e=null})}]),ViewState.prototype.setActive=function(a){this._active=a},ViewState.prototype.isActive=function(){for(var a=0;a<arguments.length;a++)if(arguments[a]==this._active)return!0},angular.module("tagyComponents").factory("editableComponentFactory",["EditableSer","EditableMessageChannel","editableContentFactory",function(a,b,c){var d=function(b,c,d){this.id=d,this.updateOpts(b,c),this._editableContentObjects=[],a.registerComponent(this)};return d.prototype.updateOpts=function(a,b){this.title=a,this.element=$(b)},d.prototype.registerEditableContentObject=function(a){for(var c=1;this.contentObjTitleExists(a.title);){var d=a.title.indexOf(":");d>0&&(a.title=a.title.substring(0,d)),a.title=a.title+":"+c,c++}this._editableContentObjects.push(a),b.dispatchEditableComponentUpdated(this)},d.prototype.unregisterEditableContentObject=function(a){this._editableContentObjects.splice(this._editableContentObjects.indexOf(a),1),b.dispatchEditableComponentUpdated(this)},d.prototype.createAndRegisterEditableContentObject=function(a){if(!this.contentObjTitleExists(a.title)){var b=c.create(a);return this.registerEditableContentObject(b),b}return null},d.prototype.contentObjTitleExists=function(a){for(var b=0;b<this._editableContentObjects.length;b++){var c=this._editableContentObjects[b];if(c.title==a)return!0}return!1},d.prototype.getEditableContentObjects=function(){return this._editableContentObjects},d.prototype.setEditableItemNewValue=function(a,b){for(var c=0;c<this._editableContentObjects.length;c++){var d=this._editableContentObjects[c];if(d.update(a,b))return!0}return!1},d.prototype.hasEditableItemObj=function(a){for(var b=0;b<this._editableContentObjects.length;b++){var c=this._editableContentObjects[b];if(c.scope.$id==a.scope.$id)return!0}return!1},d.prototype.destroy=function(){a.unregisterComponent(this.id)},{getInstance:function(c,e,f,g){null==g&&(g=f.$id);var h=a.getRegisteredComponent(g);return null==h&&(h=new d(c,e,g)),null!=f&&(b.onEditableContentObjectAdded(f,function(a){h.registerEditableContentObject(a)}),b.onEditableContentObjectRemoved(f,function(a){h.unregisterEditableContentObject(a)})),h},getViewComponentAttributeName:function(){return"tagy-cms-editable"},getEditableComponentAttributeName:function(){return"tagy-cms-component"},getViewComponentDirectiveName:function(){return"tagyCmsEditable"}}}]),angular.module("tagyComponents").factory("editableContentFactory",["EditableMessageChannel",function(a){var b=function(a,b,c,d,e,f,g){this.registered=!1,this.updateOpts(a,b,c,d,e,f,g)};b.prototype.updateOpts=function(a,b,c,d,e,f,g){this.element=$(a),this.scope=b,this.title=c,this.description=d,this.type=null!=this.element&&this.element.length>0?this._getType():e,this.value=f,null==this.editProps&&(this.editProps={}),null!=g&&(this.editProps=g)},b.prototype._getType=function(){switch(this.element.prop("tagName").toLowerCase()){case"img":return"image";default:return"text"}return element.prop("tagName")},b.prototype.update=function(a,b){return this.scope.$id==b?(angular.isObject(a)?this.editProps=a:this.value=a,null!=this.scope.update&&this.scope.update(a),!0):!1},b.prototype.registerOnComponent=function(){return 1!=this.registered&&null!=this.scope&&null!=this.scope.$emit&&(a.dispatchEditableContentObjectAdded(this.scope,this),this.registered=!0),this.registered},b.prototype.destroy=function(){1==this.registered&&null!=this.scope&&null!=this.scope.$emit&&(a.dispatchEditableContentObjectRemoved(this.scope,this),this.registered=!1)};var c={getInstance:function(a,c,d,e,f,g,h){var i=new b(a,c,d,e,f,g,h);return i},getAndRegisterInstance:function(a,b,d,e,f,g,h){var i=c.getInstance(a,b,d,e,f,g,h);return i.registerOnComponent(),i},create:function(a){return c.getInstance(null,a.scope,a.title,a.description,a.type,a.value,a.editProps)},getViewComponentAttributeName:function(){return"tagy-cms-editable"},getViewComponentDirectiveName:function(){return"tagyCmsEditable"}};return c}]),angular.module("tagyComponents").service("EditableMessageChannel",["$rootScope",function(a){var b=this;this.EVENT_EDIT="tagyComponents:tagyCmsEditable:editableItemEdit",this.EVENT_EDIT_CONFIRMED="tagyComponents:tagyCmsEditable:editableItemEditComplete",this.EVENT_HOVER_OVER="tagyComponents:tagyCmsEditable:editableItemHoverOver",this.EVENT_HOVER_OUT="tagyComponents:tagyCmsEditable:editableItemHoverOut",this.EVENT_EDIT_UPDATED="tagyComponents:tagyCmsEditable:editableItemSaved",this.EVENT_NEW_VALUE_UPDATE_EDITABLE="tagyComponents:tagyCmsEditable:updateEditableValue",this.EVENT_EDITABLE_CONTENT_OBJECT_ADDED="tagyComponents:tagyCmsEditable:editableContentObjectAdded",this.EVENT_EDITABLE_CONTENT_OBJECT_REMOVED="tagyComponents:tagyCmsEditable:editableContentObjectRemoved",this.EVENT_EDITABLE_COMPONENT_ADDED="tagyComponents:tagyCmsEditable:editableComponentAdded",this.EVENT_EDITABLE_COMPONENT_REMOVED="tagyComponents:tagyCmsEditable:editableComponentRemoved",this.EVENT_EDITABLE_COMPONENT_UPDATED="tagyComponents:tagyCmsEditable:editableComponentUpdated",this.EVENT_EDITABLE_MARKUP_CHANGED="tagyComponents:tagyCmsEditable:editableMarkupChanged",this.EVENT_EDITABLE_IFRAME_PREVIEW_MARKUP_RESET="tagyComponents:tagyCmsEditable:editableIframePreviewMarkupReset",this.EVENT_EDITABLE_SELECT_IMAGE_WAITING="tagyComponents:tagyCmsEditable:editableSelectImageReady",this.EVENT_EDITABLE_SELECTED_IMAGE_PATH="tagyComponents:tagyCmsEditable:editableSelectedImagePath",this.EVENT_EDITABLE_STYLE_VALUE_CHANGE="tagyComponents:tagyCmsEditable:editableStyleValueChange",this.EVENT_EDITABLE_STYLE_ITEM_ADDED="tagyComponents:tagyCmsEditable:editableStyleItemAdded",this.EVENT_EDITABLE_STYLE_VALUE_UPDATED="tagyComponents:tagyCmsEditable:editableStyleValueUpdated",this.onEdit=function(a,c){a.$on(b.EVENT_EDIT,function(a,b){c(b)})},this.onUpdated=function(a,c){a.$on(b.EVENT_EDIT_UPDATED,function(a,b,d){c(b,d)})},this.dispatchUpdatedEvent=function(c,d){a.$broadcast(b.EVENT_EDIT_UPDATED,c,d)},this.dispatchEditEvent=function(c){a.$broadcast(b.EVENT_EDIT,c)},this.onNewValueUpdateEditable=function(a,c){a.$on(b.EVENT_NEW_VALUE_UPDATE_EDITABLE,function(a,b,d){c(b,d)})},this.dispatchNewValueUpdate=function(c,d){var e;return e=angular.isObject(d)?null!=d.scope?d.scope.$id:d.$id:d,null==e?void console.log("ERROR - dispatchValueUpdate scopeId not set param=",d):void a.$broadcast(b.EVENT_NEW_VALUE_UPDATE_EDITABLE,c,e)},this.dispatchEditableItemHoverOver=function(c){a.$broadcast(b.EVENT_HOVER_OVER,c)},this.dispatchEditableItemHoverOut=function(c){a.$broadcast(b.EVENT_HOVER_OUT,c)},this.onEditableContentObjectAdded=function(a,c){a.$on(b.EVENT_EDITABLE_CONTENT_OBJECT_ADDED,function(a,b){c(b),a.stopPropagation()})},this.dispatchEditableContentObjectAdded=function(a,c){a.$emit(b.EVENT_EDITABLE_CONTENT_OBJECT_ADDED,c)},this.onEditableContentObjectRemoved=function(a,c){a.$on(b.EVENT_EDITABLE_CONTENT_OBJECT_REMOVED,function(a,b){c(b),a.stopPropagation()})},this.dispatchEditableContentObjectRemoved=function(a,c){a.$emit(b.EVENT_EDITABLE_CONTENT_OBJECT_REMOVED,c)},this.onEditableComponentAdded=function(a,c){a.$on(b.EVENT_EDITABLE_COMPONENT_ADDED,function(a,b,d){c(b,d)})},this.dispatchEditableComponentAdded=function(c,d){a.$broadcast(b.EVENT_EDITABLE_COMPONENT_ADDED,c,d)},this.onEditableComponentRemoved=function(a,c){a.$on(b.EVENT_EDITABLE_COMPONENT_REMOVED,function(a,b,d){c(b,d)})},this.dispatchEditableComponentRemoved=function(c,d){a.$broadcast(b.EVENT_EDITABLE_COMPONENT_REMOVED,c,d)},this.dispatchEditableComponentUpdated=function(c,d){a.$broadcast(b.EVENT_EDITABLE_COMPONENT_UPDATED,c,d)},this.onEditableComponentUpdated=function(a,c){a.$on(b.EVENT_EDITABLE_COMPONENT_UPDATED,function(a,b){c(b)})},this.onEditableHtmlMarkupChange=function(a,c){a.$on(b.EVENT_EDITABLE_MARKUP_CHANGED,function(a,b,d,e){c(b,d,e)})},this.dispatchEditableHtmlMarkupChange=function(c,d,e){a.$broadcast(b.EVENT_EDITABLE_MARKUP_CHANGED,c,d,e)},this.onIframePreviewHtmlMarkupReset=function(a,c){a.$on(b.EVENT_EDITABLE_IFRAME_PREVIEW_MARKUP_RESET,function(a,b,d){c(b,d)})},this.dispatchIframePreviewHtmlMarkupReset=function(c,d){a.$broadcast(b.EVENT_EDITABLE_IFRAME_PREVIEW_MARKUP_RESET,c,d)},this.onEditableItemEditConfirmed=function(a,c){a.$on(b.EVENT_EDIT_CONFIRMED,function(a,b){c(b)})},this.dispatchEditableItemEditConfirmed=function(c){a.$broadcast(b.EVENT_EDIT_CONFIRMED,c)},this.onSelectImageWaiting=function(a,c){a.$on(b.EVENT_EDITABLE_SELECT_IMAGE_WAITING,function(a,b){c(b)
})},this.dispatchSelectImageWaiting=function(c){a.$broadcast(b.EVENT_EDITABLE_SELECT_IMAGE_WAITING,c)},this.onSelectedImagePath=function(a,c){a.$on(b.EVENT_EDITABLE_SELECTED_IMAGE_PATH,function(a,b){c(b)})},this.dispatchSelectedImagePath=function(c){a.$broadcast(b.EVENT_EDITABLE_SELECTED_IMAGE_PATH,c)},this.onStyleValueChange=function(a,c){a.$on(b.EVENT_EDITABLE_STYLE_VALUE_CHANGE,function(a,b){c(b)})},this.dispatchStyleValueChange=function(c){a.$broadcast(b.EVENT_EDITABLE_STYLE_VALUE_CHANGE,c)},this.onEditableStyleItemAdded=function(a,c){a.$on(b.EVENT_EDITABLE_STYLE_ITEM_ADDED,function(a,b,d){c(b,d)})},this.dispatchEditableStyleItemAdded=function(c,d){a.$broadcast(b.EVENT_EDITABLE_STYLE_ITEM_ADDED,c,d)},this.onStyleValueUpdatedEvent=function(a,c){a.$on(b.EVENT_EDITABLE_STYLE_VALUE_UPDATED,function(a,b){c(b)})},this.dispatchStyleValueUpdatedEvent=function(c){a.$broadcast(b.EVENT_EDITABLE_STYLE_VALUE_UPDATED,c)},this.rootScopeBroadcast=function(b){a.$broadcast.apply(a,b)}}]),angular.module("tagyComponents").factory("markupChangeIdFac",function(){var a='<meta name="meta-change-id" content="',b=0,c=function(a){b=angular.isNumber(parseFloat(a))?a:0},d=function(b){return b.indexOf(a)},e=function(a,b){return a.indexOf(">",b)},f=function(b){if(null==b)return null;var c=d(b),f=null;if(c>-1){var g=e(b,c);f=parseInt(b.substring(c+a.length,g))}return f},g=function(b){return null==b&&(b=h()),a+b+'">'},h=function(){return++b},i=function(){return b},j={getCurrentChangeId:i,getMarkupChangeId:f,getMetaTagStr:g,changeMarkupChangeId:function(a){if(null==a)return null;var b=f(a);if(null==b){var c=a.indexOf("<html");if(c>-1){if(a.indexOf("<head")<0){var d=a.indexOf(">",c);d>-1?a=a.substring(0,d+1)+"<head></head>"+a.substring(d+1):console.log("INFO markup-change-id-fac.js - is html tag closed?")}var e=a.indexOf(">",a.indexOf("<head"))+1;return a.substring(0,e)+j.getMetaTagStr()+a.substring(e)}return j.wrapMarkupInHtmlTags(a)}return a.replace(g(b),g(h()))},nextChangeId:h,setCurrChangeId:c,wrapMarkupInHtmlTags:function(a){var b="<!DOCTYPE html><html><head>"+j.getMetaTagStr()+"</head><body>"+a.toString()+"</body></html>";return b}};return j}),angular.module("tagyComponents").service("EditableStyleSer",["EditableMessageChannel","$rootScope",function(a,b){var c=this;this._editableStyleItems=[],a.onStyleValueChange(b,function(a){for(var b=0;b<c._editableStyleItems.length;b++){var d=c._editableStyleItems[b];if(d.update(a))return!0}}),this.unregisterStyles=function(){c._editableStyleItems=[],a.dispatchEditableStyleItemAdded(null,c._editableStyleItems)},this.registerStyleItem=function(b){c._editableStyleItems.push(b),a.dispatchEditableStyleItemAdded(b,c._editableStyleItems)},this.getEditableStyleItems=function(){return c._editableStyleItems}}]),angular.module("tagyComponents").factory("editableStyleItemFactory",["EditableMessageChannel","uuid4","EditableStyleSer",function(a,b,c){var d=function(a,b,d,e,f,g,h,i){this.updateOpts(a,b,d,e,f,g,h,i),c.registerStyleItem(this)};d.prototype.updateOpts=function(a,c,d,e,f,g,h,i){null==this.id&&(this.id=b.generate()),this.element=$(a),this.scope=c,this.title=f,this.className=d,this.bodyCss=e,this.type=g,this.cssProperty=i,this.type=g,this.value=h},d.prototype.update=function(a){return this.id==a.id?(this.value=a.value,this.scope&&null!=this.scope.update&&this.scope.update(this),!0):!1};var e={getInstance:function(a,b,c,e,f,g,h,i){var j=new d(a,b,c,e,f,g,h,i);return j},create:function(a){return e.getInstance(a.element,a.scope,a.className,a.bodyCss,a.title,a.type,a.value,a.cssProperty)}};return e}]),angular.module("tagyComponents").service("EditHtmlService",["$rootScope","$q","$timeout","EditableSer","markupChangeIdFac","editableComponentFactory","EditableMessageChannel",function(a,b,c,d,e,f,g){this.removeInProductionClassName="remove-in-production",this.removeEditGeneratedTagsAfterThisMetaElement='<meta class="remove-added-tags-to-head-from-here">';var h="",i="bower-tagy-components-iframe-app/scripts/scripts.js",j=[],k=[],l='ng-app="tagyCmsClientApp"',m="tagy-cms-edit-mode",n=this,o=null,p=null;this.editHtmlMarkup=function(a,c){var d=b.defer(),f=null;if(null!=a){f=e.getMarkupChangeId(a);var h=c||p>=f;a=n.getIframeHtmlMarkup(a,h),h&&(f=e.getMarkupChangeId(a)),o=a;var i=n.cleanEditFrameworkCode(a);g.dispatchEditableHtmlMarkupChange(i,f,o)}return d.promise},this.getDocTypeAsString=function(a){var b=a.doctype;return b?"<!DOCTYPE "+b.name+(b.publicId?' PUBLIC "'+b.publicId+'"':"")+(!b.publicId&&b.systemId?" SYSTEM":"")+(b.systemId?' "'+b.systemId+'"':"")+">\n":""},this.cleanEditFrameworkCode=function(a){a=a.replace(m,"");var b=a.indexOf(n.removeEditGeneratedTagsAfterThisMetaElement);if(0>b)return a;var c=a.indexOf("</head>",b);a=a.slice(0,b)+a.slice(c);var d=n.getStringInsideBodyOrHeadTag(a,"body"),e=$("<div/>").html(d);e.find("."+n.removeInProductionClassName).remove(),e.find("["+n.removeInProductionClassName+"]").remove(),a=n.replaceStringInsideBodyOrHeadTag(a,e.html(),"body"),a=n.makeHtmlClassValuesUnique(a);for(var f=".ng-hide",g=a.indexOf(f);g>-1;){b=a.lastIndexOf("<style",g);var h="</style>";c=a.indexOf(h,g)+h.length,a=a.substring(0,b)+a.substr(c),g=a.indexOf(f)}var i=s(a,!1);return null!=i&&(a=a.substring(0,i[0])+a.substring(i[1])),a=n.cleanEditableMarkupWraps(a)},this.cleanEditableMarkupWraps=function(a){var b=a,c=n.getStringInsideBodyOrHeadTag(b,"body"),e=c.length>0;e||(c=b);var f=$("<div/>").html(c);return f.find("["+d.EDITABLE_BINDING_WRAP_ATTR_NAME+"]").each(function(a,b){var c=$(b),d=c.html(),e=c.parent();e.html(d),e.removeClass("ng-isolate-scope"),e.removeClass("ng-scope");var f=e.attr("class").split(/\s+/);null!=f&&(f.length<1||1==f.length&&f[0].length<1)&&e.removeAttr("class")}),e?n.replaceStringInsideBodyOrHeadTag(b,f.html(),"body"):f.html()},this.cleanRemoveInProductionCssClasses=function(a){var b=n.getStringInsideBodyOrHeadTag(a,"body"),c=b.length>0;c||(b=a);for(var d=$("<div/>").html(b),e=d.find("*"),f=0;f<e.length;f++){var g=$(e[f]),h=g.attr("class");if(h){var i=h.match(/[\w-]*_remove-in-production[\w-]*/g);if(i&&i.length>0)for(var j=0;j<i.length;j++){var k=i[j];g.removeClass(k)}}}return c?n.replaceStringInsideBodyOrHeadTag(a,d.html(),"body"):d.html()},this.clearAndAppendToHeadElement=function(a,b,c){c&&(a=a.replace(b,""));var d=a.indexOf("</head>");if(0>d)return a;var e=a.slice(0,d)+b+a.slice(d);return e},this.getBodyOrHeadOpenTag=function(a,b){var c="<"+b,d=">",e=a.indexOf(c);if(0>e)return"";var f=a.indexOf(d),g=a.slice(e,f);return g},this.getStringInsideBodyOrHeadTag=function(a,b){var c="<"+b,d=">",e=a.indexOf(c);if(0>e)return"";var f=a.indexOf(d,e)+1,g=a.indexOf("</"+b),h=a.slice(f,g);return h},this.replaceStringInsideBodyOrHeadTag=function(a,b,c){var d="<"+c,e=">",f=a.indexOf(d);if(0>f)return"";var g=a.indexOf(e,f)+1,h=a.indexOf("</"+c),i=a.slice(0,g)+b+a.slice(h);return i},this.makeHtmlClassValuesUnique=function(a){var b="<html",c=">",d=a.indexOf(b);if(0>d)return a;var e=a.indexOf(c,d)+1,f=a.slice(d+b.length,e),g=$("<div"+f+"</div>"),h=[],i=null;try{i=g.attr("class"),h=_.uniq(i.split(" "))}catch(j){}if(null!=i){f.replace("'",'"');var k=f.indexOf("class"),l=f.indexOf('"',k)+1,m=f.indexOf('"',l);f=f.slice(0,l)+h.join(" ")+f.slice(m);var n="<html"+f,o=a.slice(0,d)+n+a.slice(e);return o}return a},this.getIframeHtmlMarkup=function(a,b){if(null==a)return"";a.indexOf("<html")<0?a=e.wrapMarkupInHtmlTags(a):b&&(a=e.changeMarkupChangeId(a)),a.indexOf(l)<0&&(a=a.replace("<html",'<html ng-app="tagyCmsClientApp" ')),a=n.addEditModeCssClass(a),a=n.addTopLevelEditableComponentAttr(a),a=u(a),a=n.clearAndAppendToHeadElement(a,n.removeEditGeneratedTagsAfterThisMetaElement);var c="",d='<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.4/angular.min.js"></script>'+q()+r()+'<script src="'+i+'"></script>';return a=n.clearAndAppendToHeadElement(a,c),a=n.clearAndAppendToHeadElement(a,d)};var q=function(){for(var a="",b=0;b<k.length;b++){var c=k[b];null!=c&&c.length>0&&(a=a+'<script src="'+c+'"></script>')}return a},r=function(){for(var a="",b="",c=0;c<j.length;c++){var d=j[c];0==c&&(b="["),null!=d&&d.length>0&&(b=b+'"'+d+'"'),c+1<j.length&&(b+=","),c+1==j.length&&(b+="]")}return b.length>0&&(a="<script>var _tagyCmsClientAppExtraModules="+b+"</script>"),a},s=function(a,b){var c="<base",d=t();if(1==b&&a.indexOf(d)>-1)return null;var e=c,f=">",g=a.indexOf(e);if(g>-1){var h=a.indexOf(f,g)+1;if("/>"!=a.substring(h-2,h)){var i=a.indexOf("</base>",g)+7;i>7&&(h=i)}return[g,h]}return null},t=function(){var a="<base";return a+' href="'+h+'"/>'},u=function(a){var b=s(a,!0);if(null!=b)return a.substring(0,b[0])+t()+a.substring(b[1]);var c="<head",d=">",e=a.indexOf(c);if(e>-1){var f=a.indexOf(d,e)+1;return a.substring(0,f)+t()+a.substring(f)}alert("No <head> tag?")};this.setIframeAppExtraModules=function(a){j=[],k=[];for(var b=0;b<a.length;b++)a[b].module&&j.push(a[b].module),a[b].src&&k.push(a[b].src)},this.setIframeAppJSFilePath=function(a){i=a},this.setIframeBaseTagHref=function(a){h=a},this.addEditModeCssClass=function(a){if(!(n.getBodyOrHeadOpenTag(a,"html").indexOf(m)>0)){var b=a.indexOf("<html"),c=a.indexOf(">",b)+1,d=a.substring(b,c),e=$($.parseXML(d+"</html>"));e.find("html").addClass(m),d=(new XMLSerializer).serializeToString(e[0]).replace("</html>","").replace("/>",">");var f=a.substring(0,b)+d+a.substring(c);return f}},this.addTopLevelEditableComponentAttr=function(a){var b=a.indexOf("<html"),c=a.indexOf(">",b),d=a.indexOf(f.getEditableComponentAttributeName());return b>-1&&c>b&&(-1==d||d>c)?a.substring(0,c)+" "+f.getEditableComponentAttributeName()+'="top level content"'+a.substring(c):(0>b&&console.log("INFO editHtmlService - no <html tag found"),a)}}]),angular.module("tagyComponents").service("CrossFrameConnection",["$window","$rootScope","$timeout","$interval","EditableMessageChannel","$injector","uuid4","$q",function(a,b,c,d,e,f,g,h){var i=this;this.EVENT_FRAME_CONNECTION_SUCCESS="CrossFrameConnection:connectionSuccEvt",this.EVENT_FRAME_DISCONNECT_SUCCESS="CrossFrameConnection:disconnectionSuccEvt",this.onFrameConnectionSuccess=function(a,b){a.$on(i.EVENT_FRAME_CONNECTION_SUCCESS,function(){b()})},this.onFrameDisconnectSuccess=function(a,b){a.$on(i.EVENT_FRAME_DISCONNECT_SUCCESS,function(){b()})};var j=function(){b.$broadcast(i.EVENT_FRAME_CONNECTION_SUCCESS)},k={};k.EVENT_ECHO_SERVICE_CALL="eventServiceCall",k.EVENT_ECHO_SERVICE_CALL_RESPONSE="eventServiceCallResponse",k.EVENT_ECHO_REGISTER="eventEchoReg",k.EVENT_ECHO_CALL="eventEchoCall",k.CONNECT_ME="connectMe",k.CONNECTED_YOU="connectedYou",k.DISCONNECT_ME="disconnectMe",k.DISCONNECTED_YOU="disconnectedYou",this.watcherTypes={},this.watcherTypes.ON_SCOPE_EVENT="onEditableMSGChannel";var l=null,m=null,n=[],o={},p={},q={};this.sendMessage=function(b){if(b._messageType==k.EVENT_ECHO_REGISTER){var c=o[b.eventName];null==c&&(o[b.eventName]=[]);var d=!1;for(var e in o[b.eventName])if(o[b.eventName][e].handlerFn==b.handlerFn){d=!0;break}d||o[b.eventName].push(b)}else b._messageType==k.EVENT_ECHO_SERVICE_CALL;null==b._callId&&(b._callId=g.generate()),null!=b.deferredResult&&(q[b._callId]=b.deferredResult),angular.isObject(b)&&(b=angular.toJson(b)),l&&l.document._crossFrameConnHandler({data:b,source:a})};var r=function(a,b){var c=b;return"scope"==a&&null!=b.$id&&(c={},c._id=b.$id),c},s=function(a,b){if("scope"==b&&null!=a._id){var c={};return c.$id=a._id,c}if(angular.isArray(a)){for(var d=0;d<a.length;d++)a[d]=s(a[d],null);return a}if(angular.isObject(a)){for(var e in a)a[e]=s(a[e],e);return a}return a},t=function(a,b){if(null!=b){if("$"==b.substr(0,1)||"__proto__"==b.toLowerCase()||"element"==b)return null;if("scope"==b.toLowerCase())return r(b,a)}if(angular.isArray(a)){for(var c=[],d=0;d<a.length;d++)try{var e=t(a[d],null);null!=e&&c.push(angular.copy(e))}catch(f){console.log("INFO argument prop copy error prop=",g,f.message)}return c}if(angular.isObject(a)){var c={};for(var g in a)try{var e=t(a[g],g);null!=e&&(c[g]=angular.copy(e))}catch(f){console.log("INFO argument prop copy error prop=",g,f.message)}return c}return a},u=function(a){return 1==p[a]?!1:(p[a]=!0,!0)};this.initListener=function(){(null==a.document._crossFrameConnHandler||null==m)&&(m=function(a){var d=a.data;if(angular.isString(d)&&"{"==d.substr(0,1)&&(d=angular.fromJson(d)),d._messageType==k.CONNECT_ME)u(d._callId)&&null==l&&(l=a.source,i.sendMessage({_messageType:k.CONNECTED_YOU,_callId:d._callId}));else if(d._messageType==k.CONNECTED_YOU)u(d._callId)&&v();else if(d._messageType==k.DISCONNECT_ME){if(u(d._callId)){var e={_messageType:k.DISCONNECTED_YOU};i.sendMessage(e),onDisconnectSuccess()}}else if(d._messageType==k.DISCONNECTED_YOU)u(d._callId)&&onDisconnectSuccess();else if(d._messageType==k.EVENT_ECHO_REGISTER)u(d._callId)&&b.$on(d.eventName,function(a){for(var b=[],c=1;c<arguments.length;c++){var d=arguments[c];b.push(t(d))}var e={_messageType:k.EVENT_ECHO_CALL,_callId:g.generate(),eventName:a.name,args:b};i.sendMessage(e)});else if(d._messageType==k.EVENT_ECHO_CALL){if(u(d._callId)){for(var h=[],j=0;j<d.args.length;j++){var m=d.args[j];h.push(s(m))}c(function(){for(var a in o[d.eventName])o[d.eventName][a].handlerFn.apply(o[d.eventName][a].handlerFn,h)},0)}}else if(d._messageType==k.EVENT_ECHO_SERVICE_CALL){if(u(d._callId)){var n=f.get(d.serviceName),p=n[d.methodName],r=null;try{r=p.apply(n,d.args)}catch(w){console.log("ERROR calling method="+d.serviceName+"."+d.methodName,d.args,w.message)}null!=d._callId&&i.sendMessage({_messageType:k.EVENT_ECHO_SERVICE_CALL_RESPONSE,_callId:d._callId,result:t(r)}),b.$apply()}}else if(d._messageType==k.EVENT_ECHO_SERVICE_CALL_RESPONSE){if(u(d._callId)){var x=q[d._callId];null!=x&&(d.result=s(d.result),c(function(){x.resolve(d.result),delete q[d._callId]},0))}}else console.log("INFO CrossFrameConnection event not cought eData._messageType=",d._messageType)},a.document._crossFrameConnHandler=m)},this._interFunc=function(){return null!=l.document._crossFrameConnHandler?void i.sendMessage({_messageType:k.CONNECT_ME}):void c(i._interFunc,50)},this.connectFrames=function(a){a.defaultView!=l&&(q={},p={},o={}),l=a.defaultView,i.initListener(),null==l?alert("ERROR .defaultView not supported in browser."):i._interFunc()};var v=function(){j(),w()},w=function(){for(var a;null!=(a=n.pop());)i.sendMessage(a)};this.addCrossFrameEventListener=function(a){a._messageType=k.EVENT_ECHO_REGISTER,n.push(a),null!=l&&w()},this.invokeServiceMethod=function(a,b,c){var d=h.defer(),e={serviceName:a,methodName:b,args:c,deferredResult:d};return e._messageType=k.EVENT_ECHO_SERVICE_CALL,n.push(e),null!=l&&w(),d.promise}}]),angular.module("tagyComponents").service("CrossFrameEditableService",["EditableStyleSer","CrossFrameConnection","editableStyleItemFactory","editableComponentFactory","$rootScope","EditableSer","EditableMessageChannel","editableContentFactory",function(a,b,c,d,e,f,g){var h=this,i=!1,j=!1;b.onFrameConnectionSuccess(e,function(){h.init(),k()}),this.init=function(a){i=a,b.initListener()};var k=function(){i||(f.unregisterComponents(),b.addCrossFrameEventListener(new EchoEventHandler(g.EVENT_EDITABLE_COMPONENT_ADDED,function(a,b){g.dispatchEditableComponentAdded(a,b)})),b.addCrossFrameEventListener(new EchoEventHandler(g.EVENT_EDITABLE_COMPONENT_REMOVED,function(a){var b=f.getRegisteredComponent(a.id);b.destroy()})),b.addCrossFrameEventListener(new EchoEventHandler(g.EVENT_EDITABLE_COMPONENT_UPDATED,function(a){for(var b=d.getInstance(a.title,null,null,a.id),c=0;c<a._editableContentObjects.length;c++){var e=a._editableContentObjects[c],f=b.createAndRegisterEditableContentObject(e);null==f&&null==e.title&&alert("Set title to editable element in "+b.title)}g.dispatchEditableComponentUpdated(b)})),b.invokeServiceMethod("EditableSer","getRegisteredComponents",null).then(function(a){for(var b=0;b<a.length;b++)for(var c=a[b],e=d.getInstance(c.title,null,null,c.id),f=0;f<c._editableContentObjects.length;f++){var g=c._editableContentObjects[f],h=e.createAndRegisterEditableContentObject(g);null==h&&null==g.title&&alert("Set title to editable element in "+e.title)}}),a.unregisterStyles(),b.invokeServiceMethod("EditableStyleSer","getEditableStyleItems",null).then(function(a){if(a)for(var b=0;b<a.length;b++){var d=a[b],e=c.create(d);e.id=d.id,e.element=null,e.scope=null}}),b.addCrossFrameEventListener(new EchoEventHandler(g.EVENT_EDIT,function(a){g.dispatchEditEvent(a)})),j||(j=!0,g.onNewValueUpdateEditable(e,l),g.onStyleValueChange(e,function(a){b.invokeServiceMethod("EditableMessageChannel","dispatchStyleValueChange",[a])})))},l=function(a,c){b.invokeServiceMethod("EditableMessageChannel","dispatchNewValueUpdate",[a,c])}}]);var _tagyCmsClientAppDependencies="undefined"!=typeof _tagyCmsClientAppExtraModules&&_tagyCmsClientAppExtraModules.length>0?_tagyCmsClientAppExtraModules.concat(["ngRoute","uuid","tagyComponents"]):["ngRoute","uuid","tagyComponents"];angular.module("tagyCmsClientApp",_tagyCmsClientAppDependencies).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).run(["CrossFrameEditableService",function(a){a.init(!0)}]),angular.module("tagyCmsClientApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);