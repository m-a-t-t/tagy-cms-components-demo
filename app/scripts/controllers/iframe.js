'use strict';

angular.module('tagyCmsComponentsDemoApp')
  .controller('IframeCtrl', function ($scope,EditableMessageChannel,EditHtmlService, $timeout) {
        $scope.previewMode=true
        $scope.loadTest=function(ver){
            var mkp
            switch(parseInt(ver)){
                case 1:
                    //mkp="<html>\n<body>\n<h1 tagy-cms-editable='title'>hi, you can edit me</h1>\n<img tagy-cms-editable='image' src='https://angularjs.org/img/AngularJS-large.png'/>\n</body>\n</html>"
                    mkp='<html class=""><head>\
                <style>h1{color:darkblue;}</style>\
                </head>\
                <body style="">\
                    <h1 tagy-cms-editable="title">I\'m annotated with "tagy-cms-editable" attribute so just click and edit me!</h1>\
                    <textarea style="width: 100%;height: 40px;"><h1 tagy-cms-editable="title">editable content here</h1></textarea>\
                    <br/><br/><img tagy-cms-editable="image 1" src="http://lh4.ggpht.com/-zQOAsAK1jOGp-CtoZmxbB7vlvAT65WLbx0iqAoQw9v0Uix_rlw0CypErCX0oEpyihy19ld2U_62jS-U=s300" style="max-height: 70px;">\
                        <img tagy-cms-editable="image 2" src="https://angularjs.org/img/AngularJS-large.png" style="max-height: 70px;">\
                            <br>\
                                <small tagy-cms-editable="image caption">same with images (click on image to edit)</small>\
                                <textarea style="width: 100%;height: 40px;"><img tagy-cms-editable="image" src="http://example.com/path/to/image"/></textarea>\
\
                                <p tagy-cms-editable="paragraph 1">To make a website editable you just use plain HTML and insert Tagy attributes. Annotated HTML is consumed by Tagy client side editor. Now you can edit parts of this page inline - by clicking on elements.<br><br>Tagy can simplify CMS websites by eliminating server-side templates. <br/><br/>For parts of page where same content is used across the site (like menu, footer,...) "tagy-cms-sync" attribute&nbsp;solves this on the server.&nbsp;\
                                <br/><br/>This is first release so there is some more work to do. If you like the concept or Wordpress plugin go to <strong>http://tagy.cnvrtly.com</strong>&nbsp;for more.\
                                \
                                </p>\
                                <p tagy-cms-editable="paragraph 2">Want to see Tagy in action? I built landing page optimization app with CMS on Google App Engine - visit http://cnvrtly.com. If you have any questions or comments contact me at <strong>matjaz.online@gmail.com</strong>. </p>\
\
                                    <h3 tagy-cms-editable="gallery title">"tagy-cms-gallery" attribute&nbsp; on parent element makes adding/removing items automagically simple</h3>\
                                    <ul tagy-cms-gallery="">\
                                        <li tagy-cms-component="gallery item" class="ng-scope"><img tagy-cms-editable="image" style="max-height:30px" src="http://lh4.ggpht.com/-zQOAsAK1jOGp-CtoZmxbB7vlvAT65WLbx0iqAoQw9v0Uix_rlw0CypErCX0oEpyihy19ld2U_62jS-U=s300"> <span tagy-cms-editable="text">Tagy logo</span></li>\
                                        <li tagy-cms-component="gallery item" class="ng-scope"><img tagy-cms-editable="image" style="max-height:30px" src="https://angularjs.org/img/AngularJS-large.png"/> <span tagy-cms-editable="text">AngularJS logo</span></li>\
                                        </ul>\
                                        <textarea style="width: 100%;height: 40px;"><ul tagy-cms-gallery><li>item 1</li><li>item 2</li></ul></textarea>\
                                        </body></html>'
                    break
                case 2:
                    mkp='<html><head></head><body><h1 tagy-cms-editable="title">Hello</h1></body></html>'
                    //mkp='<span  editable-component-dr editable-title="title component" editable-description="just some title to edit"><h3 editable-content-dr editable-title="I am title" editable-description="title description">This is iframe nr222</h3></span>'
                    //mkp='<!DOCTYPE html> <html class="no-js  ng-scope" ng-app="magnetCmsApp"> <head> <meta name="meta-change-id" content="4" /> <meta name="magnetCmsPageId" content="5821914069073920" /> <meta charset="utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width" /> <!-- Place favicon.ico and apple-touch-icon.png in the root directory --> <script> (function(doc, elTagName) { var js, fjs = (doc.getElementsByTagName(elTagName)[0]||doc.head), add = function(url, id) { if (doc.getElementById(id)) {return;} js = doc.createElement(elTagName); if(elTagName==\' link \'){ js.href = url; js.type="text/css"; js.rel="stylesheet"; }else{ js.src=url; js.async="true"; js.type="text/javascript"; } id && (js.id = id); if(fjs==doc.head){ doc.head.appendChild(js) }else{ fjs.parentNode.insertBefore(js, fjs); } }; setTimeout(function(){ add(\'//fonts.googleapis.com/css?family=Playball&subset=latin\',"font1_id"); add(\'//fonts.googleapis.com/css?family=Raleway&subset=latin\',"font2_id"); },0) }(document, \'link\')); </script>  <style magnet-cms-shared-id="global-style-2"> zig zag items*/ .editable-odd_item_background-color:nth-child(odd) { background-color: #fafafa; } .editable-odd_item_text-color:nth-child(odd) { color: #16a085; } .editable-odd_item_text-color:nth-child(odd) a{ color: #34495e; } .content-w:nth-child(odd) .editable-item_title-color { color: #34495e; } body*/ .editable-body_background-color { background-color: #eeeff7; } .editable-body_background-color a{ color: #34495e; } .editable-body_text-color { color: #16a085; } .editable-item_title-color { color: #34495e; } style-section-2*/ .editable-body_background-color .style-section-2{ background-color: #34495e; } .editable-body_background-color .style-section-2 a{ color: #eeeff7; } .editable-body_text-color .style-section-2 { color: #eeeff7; } .style-section-2 .editable-item_title-color { color: #eeeff7; } </style> <style magnet-cms-shared-id="global-style-1" editable-style=""> header*/ .editable-header_title-color { color: #fff; } CTA button*/ .editable-cta_button_text-color, .style-section-2 a.editable-cta_button_text-color{ color: #fff; } .editable-cta_button_background-color{ background-color: #f1c40f; } .editable-cta_button_background-color:hover{ background-color: #f7df3a; } .editable-cta_button_border-color{ border-color: #fff; } </style> </head> <body class="editable-body_text-color editable-body_background-color" style=""> <div editable-component-dr="" editable-title="background" editable-description="" class="ng-scope"> <div editable-content-dr="" editable-title="body background image" editable-props="background-image" style="background-image: url(/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_bg-pattern0.png)"> <!--[if lt IE 7]> <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p> <![endif]--> <!--[if lt IE 9]> <link rel="stylesheet" href="/files/_templates_foundation-ie-8.css"> <script src="/files/_templates_es5-shim.min.js"></script> <script src="/files/_templates_json3.min.js"></script> <![endif]--> <div class="main-w"> <div magnet-cms-shared-id="top-nav"> <nav data-magellan-expedition="fixed" style="z-index: 5;width: 100%; padding: 5px;border-bottom: solid 3px #ccc; background-size: cover; background-image: url(\'/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_background-1.jpg\')" class="editable-body_background-color top-nav ng-isolate-scope" editable-content-dr="" editable-title="nav background" editable-props="background-image"> <div class="row"> <img style="max-height: 50px;float: left" editable-content-dr="" editable-title="logo image" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_logo-icon.png"> <ul class="sub-nav" style="margin-bottom: 0px; float:left"> <li style="margin: 10px 20px 0px 20px; font-size: 1.3em"><a href="#">home</a></li> <li style="margin: 10px 20px 0px 20px; font-size: 1.3em"><a href="#">blog</a></li> </ul> <div class="row"></div> </div> </nav> </div> <div editable-component-dr="" editable-title="header" editable-description="" class="ng-scope"> <header class="header-w overlapped-item ng-isolate-scope" style="margin-bottom:35px;background-image: url(\'/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_background-1.jpg\')" editable-content-dr="" editable-title="top image" editable-props="background-image"> <div class="row"> <div class="small-12 large-12 columns header-content-margin"> <div class="text-right"> <h1 editable-content-dr="" editable-title="Main Title" editable-description="" class="editable-header_title-color header-title text-background ng-isolate-scope">How to optimize Facebook ads.</h1> <br> <div class="small-12 large-6 columns" style="float: right;padding: 0px;clear: both"> <p class="text-background-dark" style="color: #fff; padding: 8px">fdsaf</p> </div> </div> </div> </div> </header> </div> <div class="above-body-w" style="display: none"></div> <div class="body-w"> <article class="overlapped-items zig-zag-titles round-header-images" magnet-cms-gallery=""> <div class="content-w editable-odd_item_background-color editable-odd_item_text-color ng-scope" editable-component-dr="" editable-title="List Item" editable-description="" style="position: relative;"> <div class="content-background"> <section class="row content"> <header class="content-header" style="text-align: center"> <img class="logo-image icon-center ng-isolate-scope" editable-content-dr="" editable-title="Header Image" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_organiziran-lov-na-medveda.jpg"> <h1 editable-content-dr="" editable-title="Title" class="content-title title-2 editable-item_title-color ng-isolate-scope">Lov na medhhvedad222</h1> <p editable-content-dr="" editable-title="Sub Title"> <small>Ursus arctos</small><br> Lovna sezona: <br>oktober - december </p> </header> <div class="content-body"> <p editable-content-dr="" editable-title="Body Text">Medved je poleg severnega medveda največja danes živeča zver- v dolžino meri od 160 do 260 cm, samice pa od 120 do 200 cm. Samci tehtajo od 200 do 400 kg, samice 150 do 350 kg. Živi lahko do 35 let. Pozimi miruje, vendar to ni pravo zimsko spanje. Telesna temperatura mu upade za 2°C, opazno se mu upočasni srčni utrip. Samica v tem času koti.</p> </div> </section> </div> </div> <div class="content-w editable-odd_item_background-color editable-odd_item_text-color ng-scope" editable-component-dr="" editable-title="List Item" editable-description="" style="position: relative;"> <div class="content-background"> <section class="row content"> <header class="content-header" style="text-align: center"> <img class="logo-image icon-center ng-isolate-scope" editable-content-dr="" editable-title="Header Image" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_organiziran-lov-na-medveda.jpg"> <h1 editable-content-dr="" editable-title="Title" class="content-title title-2 editable-item_title-color ng-isolate-scope">Lov na medhhvedad</h1> <p editable-content-dr="" editable-title="Sub Title"> <small>Ursus arctos</small><br> Lovna sezona: <br>oktober - december </p> </header> <div class="content-body"> <p editable-content-dr="" editable-title="Body Text">Medved je poleg severnega medveda največja danes živeča zver- v dolžino meri od 160 do 260 cm, samice pa od 120 do 200 cm. Samci tehtajo od 200 do 400 kg, samice 150 do 350 kg. Živi lahko do 35 let. Pozimi miruje, vendar to ni pravo zimsko spanje. Telesna temperatura mu upade za 2°C, opazno se mu upočasni srčni utrip. Samica v tem času koti.</p> </div> </section> </div> </div> <div class="content-w editable-odd_item_background-color editable-odd_item_text-color ng-scope" editable-component-dr="" editable-title="List Item" editable-description="" style="position: relative;"> <div class="content-background"> <section class="row content"> <header class="content-header" style="text-align: center"> <img class="logo-image icon-center ng-isolate-scope" editable-content-dr="" editable-title="Header Image" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_lov-na-zivali-divjega-prasica.png"> {{1+1}} <h1 editable-content-dr="" editable-title="Title" class="content-title title-2 editable-item_title-color ng-isolate-scope">Lov na divjega prašiča</h1> <p editable-content-dr="" editable-title="Sub Title"> <small>Sus scrofa</small><br> Lovna sezona: <br>merjasec: 1. 4. - 31. 1., <br>svinja: 1. 7. - 31. 1. </p> </header> <div class="content-body"> <p editable-content-dr="" editable-title="Body Text">Je vsejedi sesalec. Prehranjuje se z koreninami, gomolji, želodom in drugimi plodovi, zelišči, jajci, deževniki, žuželkami, glodavci, mrhovino. Aktiven je podnevi in ponoči, živi v družinah, samec se pridruži skupinam le v paritvenem obdobju. Ima stalne teritorije. Hrano išče in lovi le ponoči. Lahko zraste do velikosti 180 cm in tehta do 180 kg, redko 250 kg. Samci so večji kot samice. Poleti je kožuh bolj ali manj siv, pozimi črnikast z gosto podlanko.</p> </div> </section> </div> </div> </article> <div class="post-article-w" style="display: none"></div> </div> <div magnet-cms-shared-id="footer"> <footer class="style-section-2 ng-isolate-scope" editable-content-dr="" editable-title="footer background image" editable-props="background-image" style="background-size:cover;background-image: url(/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_background-1.jpg)"> <div class="row ng-scope" editable-component-dr="" editable-title="Bottom Description" editable-description=""> <div class="small-12 columns text-center"> <img editable-content-dr="" editable-title="footer logo" class="logo-image-size ng-isolate-scope" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_logo.png"> </div> <ul class="small-block-grid-1 large-block-grid-2 small-centered center-item-content"> <li> <div class="small-12 columns"> <div class="row title-row"> <div class="small-12 columns"> <i class="fa-phone fa fa-4x double-border icon-center" style="color: #ccc; background-color: #ecf0f1"></i> <div> <h3 editable-content-dr="" editable-title="Item 1 Title" class="text-center content-title title-2 editable-item_title-color ng-isolate-scope">Kontakt</h3> <hr> </div> </div> </div> <div class="row"> <div class="small-12 columns"> <p class="text-justify"> <span editable-content-dr="" editable-title="Tel Nr."><i class="fa fa-phone-square"></i> GSM: +386 (0)6 816-2934</span><br> <a href="tel:+386068162934" editable-content-dr="" editable-title="Link Phone Number" editable-props="" class="cta-button button tiny round editable-cta_button_border-color ng-isolate-scope"> <span class="fa-stack fa-lg"> <i class="fa fa-mobile-phone fa-stack-2x editable-cta_button_icon-color"></i> <i class="fa fa-phone editable-cta_button_icon-color" style="font-size: 0.6em"></i> </span> <span editable-content-dr="" editable-title="Button Text">klikni za klic na telefonu</span> </a> <br><br> <i class="fa fa-envelope-square"></i> <span editable-content-dr="" editable-title="Email"><a href="mailto:aleksandra.bombek@gmail.com">aleksandra.bombek@gmail.com</a></span> <br><br> <i class="fa fa-question-circle"></i> <a href="" editable-content-dr="" editable-title="CTA 1 Button Text" mp-open-form="" mp-conversion-click="">pošljite vprašanje</a> <br> </p> </div> </div> </div> </li> <li> <div class="small-12 columns"> <div class="row title-row"> <div class="small-12 columns"> <i class="fa-map-marker fa fa-4x double-border icon-center" style="color: #ccc; background-color: #ecf0f1"></i> <div> <h3 editable-content-dr="" editable-title="Item 2 Title" class="text-center content-title title-2 editable-item_title-color ng-isolate-scope">Podjetje</h3> <hr> </div> </div> </div> <div class="row"> <div class="small-12 columns"> <p editable-content-dr="" editable-title="Item 2 Body" class="text-justify ng-isolate-scope"> Canis lupus, lovni turizem in gradbeni inženiring – Aleksandra Bombek s.p.<br> Travna gora 31<br> 1317 Sodražica<br> Davčna številka: 3442611<br> Matična številka: 6488811000 </p> </div> </div> </div> </li> </ul> </div> <div class="row ng-scope" editable-component-dr="" editable-title="Bottom CTA, Logo"> <div class="small-12 large-8 columns" style="text-align: right"> <div class="text-center"> <div class="call-to-action-widget"> <img editable-content-dr="" editable-title="CTA 1 Image" class="portrait-cta ng-isolate-scope" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_portrait-1.jpg"> <div class="body-cta"> <div class="cta-text ng-isolate-scope" editable-content-dr="" editable-title="CTA 1 Text"> Sem Matjaž, vaša pomoč pri konverzijah na spletu </div> <a href="" class="cta-button button round editable-cta_button_text-color editable-cta_button_background-color editable-cta_button_border-color fat-border ng-isolate-scope" editable-content-dr="" editable-title="CTA 1 Button Text" mp-open-form="" mp-conversion-click="">kliknite za informacije</a> </div> </div> </div> </div> <div class="small-12 large-4 columns" style="text-align: right"> <img editable-content-dr="" editable-title="Logo" style="margin: 70px auto" class="logo-image-size ng-isolate-scope" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_logo-icon.png"> </div> </div> </footer> </div> <aside mp-form-modal="" id="mp-form-modal" class="reveal-modal small text-center ng-scope" data-reveal="" editable-component-dr="" editable-title="Overlay Call CTA"> <h2 ng-show="viewState.isActive(\'\')" class="editable-item_title-color ng-isolate-scope ng-hide" editable-content-dr="" editable-title="Title">Kaj vas zanima?</h2> <div ng-show="viewState.isActive(\'\')" class="call-to-action-widget text-center ng-hide"> <img editable-content-dr="" editable-title="Image" class="portrait-cta ng-isolate-scope" style="max-width: 150px" src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_portrait-1.jpg"> <div class="body-cta"> <div class="cta-text ng-isolate-scope" style="margin-left: 20px" editable-content-dr="" editable-title="Body"> Pošljite vaše vprašanje </div> </div> </div> <div ng-show="viewState.isActive(\'\')" class="ng-hide"> <form class="ng-pristine ng-valid"> <div class="row"> <div class="large-12 columns"> <label>Vaš email: <input type="text" placeholder="email"> </label> </div> <div class="row"> <div class="large-12 columns"> <label>Vpišite sporočilo: <textarea placeholder="vaše sporočilo"></textarea> </label> </div> </div> </div> </form> </div> <a class="close-reveal-modal">×</a> </aside> </div> </div> </div> <!--  LAZY SCRIPTS--> <script type="text/javascript">window._mp_init_script_path=\'/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_script.js\'</script> <script src="/files/_templates_sites_cnvrtly_cnvrtly-big-image-header-post_app.js"></script> <!-- end  LAZY SCRIPTS--> </body> </html>'

                    break
            }
            $scope.editHtml=mkp
        }

        $scope.showHtml=function(){

            alert($scope.updatedHtml)
        }

        $scope.updatedHtml=""

        EditableMessageChannel.onEditableHtmlMarkupChange($scope,function(markup, changeId){
            $scope.updatedHtml=markup
        })

        $scope.selectImage=function(path){
            EditableMessageChannel.dispatchSelectedImagePath(path)
        }

        $scope.clearHtml=function(){
            $scope.loadTest(2)
            EditHtmlService.editHtmlMarkup($scope.editHtml)
        }

        $timeout(function(){
            $scope.loadTest(1)
            EditHtmlService.editHtmlMarkup($scope.editHtml)
        },10)

  });
